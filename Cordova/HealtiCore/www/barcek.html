<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Healtie</title>
    <link rel="icon" href="assets/images/favicon/icon.png">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800;900&amp;display=swap"
        rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&amp;display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="assets/css/all.min.css">
    <link rel="stylesheet" href="assets/css/slick.css">
    <link rel="stylesheet" href="assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/media-query.css">
</head>

<body>
    <div class="site_content">
        <!-- Preloader Start -->
        <div class="loader-mask">
            <div class="loader">
                <div></div>
                <div></div>
            </div>
        </div>
        <!-- Preloader End -->
        <!-- Header Section Start -->
        <header id="top-navbar" class="top-navbar">
            <div class="container">
                <div class="top-navbar_full">
                    <div class="menu-btn d-flex align-items-center">
                        <a href="#offcanvasExample" data-bs-toggle="offcanvas"><img
                                src="assets/images/profile-page/menu-icon.svg" alt="menu-icon"></a>
                    </div>
                    <div class="brookwood-txt d-flex align-items-center">
                        <p>Brookwood</p>
                    </div>
                    <div>
                        <ul class="homepage-cart-sec">
                            <li><a href="search-page.html"><img src="assets/images/homepage/search-icon.svg"
                                        alt="search-icon"></a></li>
                            <li class="pf-16"><a href="shopping-cart.html"><img
                                        src="assets/images/homepage/cart-icon.svg" alt="cart-icon"><span
                                        class="cart-item">2</span></a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="navbar-boder"></div>
        </header>
        <!-- Header Section End -->
        <!-- Notification Section Start -->
        <section id="notification-page">
            <div class="col-12 rounded" id="reader" style="height: 70vh; width: 100vw;"></div>
            <div class="container">
                <div class="container-fluid card">
                    <div class="row">
                        <div class="col-12 text-center">
                            <h2 style="font-size: medium;">
                                You can also input the nutrition manually
                            </h2>
                        </div>
                        <div class="col-6">
                            <div class="card">
                                <div class="card-body text-center">
                                    <div class="col-12">
                                        <iconify-icon icon="cryptocurrency-color:qrl" width="40"
                                            height="40"></iconify-icon>
                                    </div>
                                    <div class="col-12">
                                        <h4 style="font-size: medium;">Scan Food</h4>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="card">
                                <div class="card-body text-center">
                                    <div class="col-12">
                                        <iconify-icon icon="ion:barcode-outline" width="40" height="40"></iconify-icon>
                                    </div>
                                    <div class="col-12">
                                        <h4 style="font-size: medium;">Scan Produk</h4>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- Bottom Navigation Start -->
        <div id="bottom-navigation">
            <div class="container">
                <div class="home-navigation-menu">
                    <div class="row">
                        <div class="col-12">
                            <div class="bottom-panel nagivation-menu-wrap">
                                <ul class="sc-bottom-bar furniture-bottom-nav" id="furniture_navbar">
                                    <li class="nav-menu-icon active">
                                        <a href="home-page2.html" class="home-icon navigation-icons active">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                                xmlns="http://www.w3.org/2000/svg">
                                                <mask id="mask0_1_798" style="mask-type:alpha"
                                                    maskUnits="userSpaceOnUse" x="0" y="0" width="24" height="24">
                                                    <rect width="24" height="24" fill="white" />
                                                </mask>
                                                <g mask="url(#mask0_1_798)">
                                                    <path
                                                        d="M8.12602 14C8.57006 15.7252 10.1362 17 12 17C13.8638 17 15.4299 15.7252 15.874 14M11.0177 2.764L4.23539 8.03912C3.78202 8.39175 3.55534 8.56806 3.39203 8.78886C3.24737 8.98444 3.1396 9.20478 3.07403 9.43905C3 9.70352 3 9.9907 3 10.5651V17.8C3 18.9201 3 19.4801 3.21799 19.908C3.40973 20.2843 3.71569 20.5903 4.09202 20.782C4.51984 21 5.07989 21 6.2 21H17.8C18.9201 21 19.4802 21 19.908 20.782C20.2843 20.5903 20.5903 20.2843 20.782 19.908C21 19.4801 21 18.9201 21 17.8V10.5651C21 9.9907 21 9.70352 20.926 9.43905C20.8604 9.20478 20.7526 8.98444 20.608 8.78886C20.4447 8.56806 20.218 8.39175 19.7646 8.03913L12.9823 2.764C12.631 2.49075 12.4553 2.35412 12.2613 2.3016C12.0902 2.25526 11.9098 2.25526 11.7387 2.3016C11.5447 2.35412 11.369 2.49075 11.0177 2.764Z"
                                                        stroke="#666666" stroke-width="2" stroke-linecap="round"
                                                        stroke-linejoin="round" />
                                                </g>
                                            </svg>
                                        </a>
                                    </li>
                                    <li class="nav-menu-icon">
                                        <a href="favourite.html" class="event-icon navigation-icons">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                                xmlns="http://www.w3.org/2000/svg">
                                                <mask id="mask0_1_793" style="mask-type:alpha"
                                                    maskUnits="userSpaceOnUse" x="0" y="0" width="24" height="24">
                                                    <rect width="24" height="24" fill="white" />
                                                </mask>
                                                <g mask="url(#mask0_1_793)">
                                                    <path
                                                        d="M16.1111 3C19.6333 3 22 6.3525 22 9.48C22 15.8138 12.1778 21 12 21C11.8222 21 2 15.8138 2 9.48C2 6.3525 4.36667 3 7.88889 3C9.91111 3 11.2333 4.02375 12 4.92375C12.7667 4.02375 14.0889 3 16.1111 3Z"
                                                        stroke="#666666" stroke-width="2" stroke-linecap="round"
                                                        stroke-linejoin="round" />
                                                </g>
                                            </svg>
                                        </a>
                                    </li>
                                    <li class="nav-menu-icon nav-account-icon">
                                        <a href="notification.html"
                                            class="notification-icon navigation-icons left-icon">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                                xmlns="http://www.w3.org/2000/svg">
                                                <mask id="mask0_1_778" style="mask-type:alpha"
                                                    maskUnits="userSpaceOnUse" x="0" y="0" width="24" height="24">
                                                    <rect width="24" height="24" fill="white" />
                                                </mask>
                                                <g mask="url(#mask0_1_778)">
                                                    <path d="M12 6.43994V9.76994" stroke="#666666" stroke-width="2"
                                                        stroke-miterlimit="10" stroke-linecap="round" />
                                                    <path
                                                        d="M12.0199 2C8.3399 2 5.3599 4.98 5.3599 8.66V10.76C5.3599 11.44 5.0799 12.46 4.7299 13.04L3.4599 15.16C2.6799 16.47 3.2199 17.93 4.6599 18.41C9.4399 20 14.6099 20 19.3899 18.41C20.7399 17.96 21.3199 16.38 20.5899 15.16L19.3199 13.04C18.9699 12.46 18.6899 11.43 18.6899 10.76V8.66C18.6799 5 15.6799 2 12.0199 2Z"
                                                        stroke="#666666" stroke-width="2" stroke-miterlimit="10"
                                                        stroke-linecap="round" />
                                                    <path
                                                        d="M15.3299 18.8201C15.3299 20.6501 13.8299 22.1501 11.9999 22.1501C11.0899 22.1501 10.2499 21.7701 9.64992 21.1701C9.04992 20.5701 8.66992 19.7301 8.66992 18.8201"
                                                        stroke="#666666" stroke-width="2" stroke-miterlimit="10" />
                                                </g>
                                            </svg>
                                        </a>
                                    </li>
                                    <li class="nav-menu-icon nav-notifi-icon">
                                        <a href="profile.html" class="account-icon navigation-icons">
                                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none"
                                                xmlns="http://www.w3.org/2000/svg">
                                                <mask id="mask0_1_772" style="mask-type:alpha"
                                                    maskUnits="userSpaceOnUse" x="0" y="0" width="24" height="24">
                                                    <rect width="24" height="24" fill="white" />
                                                </mask>
                                                <g mask="url(#mask0_1_772)">
                                                    <path
                                                        d="M20 21C20 19.6044 20 18.9067 19.8278 18.3389C19.44 17.0605 18.4395 16.06 17.1611 15.6722C16.5933 15.5 15.8956 15.5 14.5 15.5H9.5C8.10444 15.5 7.40665 15.5 6.83886 15.6722C5.56045 16.06 4.56004 17.0605 4.17224 18.3389C4 18.9067 4 19.6044 4 21M16.5 7.5C16.5 9.98528 14.4853 12 12 12C9.51472 12 7.5 9.98528 7.5 7.5C7.5 5.01472 9.51472 3 12 3C14.4853 3 16.5 5.01472 16.5 7.5Z"
                                                        stroke="#666666" stroke-width="2" stroke-linecap="round"
                                                        stroke-linejoin="round" />
                                                </g>
                                            </svg>
                                        </a>
                                    </li>
                                </ul>
                                <a class="sc-nav-indicator" href="#">
                                    <iconify-icon icon="ph:barcode-light" width="40" height="40"
                                        style="padding-top: 0.5rem;padding-left: 0.5rem;color: #ffffff;"></iconify-icon>

                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Bottom Navigation End-->
    </div>
    <!-- Button trigger modal -->
    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#poinUpdate" id="tombolmodal1">

    </button>

    <!-- Modal -->
    <div class="modal fade" id="poinUpdate" tabindex="-1" aria-labelledby="poinupdate" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="poinupdate">Barang Mu Belum Di temukan</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <h1>Hallo Tolong Bantu Untuk Mendatanya ya</h1>
                    <form action="/addfood" method="post">
                        <input type="text" class="form-control mt-1" value="Nama Produk" id="NamaProduk"
                            name="NamaProduk" placeholder="NamaProduk">
                        <input type="text" class="form-control mt-1" value="Kalori" id="fdKalorif" name="Kalori"
                            placeholder="Kalori">
                        <input type="text" class="form-control mt-1" value="Fat" id="fdFat" name="Fat"
                            placeholder="Fat">
                        <input type="text" class="form-control mt-1" value="Natrium" id="fdNatrium" name="Natrium"
                            placeholder="Natrium">
                        <input type="text" class="form-control mt-1" value="Sugar" id="fdSugar" name="Sugar"
                            placeholder="Sugar">
                        <input type="text" class="form-control mt-1" value="Barcode" id="fdBarcode" name="Barcode"
                            placeholder="Barcode" readonly>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary">Save changes</button>
                </div>
            </div>
        </div>
    </div>
    <script src="assets/js/jquery-min-3.6.0.js"></script>
    <script src="assets/js/slick.min.js"></script>
    <script src="assets/js/bootstrap.bundle.min.js"></script>
    <script src="assets/js/custom.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/apexcharts@3.28.0/dist/apexcharts.min.css" />
    <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5-qrcode/2.3.8/html5-qrcode.min.js"
        integrity="sha512-r6rDA7W6ZeQhvl8S7yRVQUKVHdexq+GAlNkNNqVC7YyIV+NwqCTJe2hDWCiffTyRNOeGEzRRJ9ifvRm/HCzGYg=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>

    <script>
        var kamerajalan = false;
        var cekbagian = document.getElementById('reader__dashboard_section_csr').style.display
        console.log(cekbagian)
        if ('WebSocket' in window) {
            (function () {
                function refreshCSS() {
                    var sheets = [].slice.call(document.getElementsByTagName("link"));
                    var head = document.getElementsByTagName("head")[0];
                    for (var i = 0; i < sheets.length; ++i) {
                        var elem = sheets[i];
                        var parent = elem.parentElement || head;
                        parent.removeChild(elem);
                        var rel = elem.rel;
                        if (elem.href && typeof rel != "string" || rel.length == 0 || rel.toLowerCase() == "stylesheet") {
                            var url = elem.href.replace(/(&|\?)_cacheOverride=\d+/, '');
                            elem.href = url + (url.indexOf('?') >= 0 ? '&' : '?') + '_cacheOverride=' + (new Date().valueOf());
                        }
                        parent.appendChild(elem);
                    }
                }
                var protocol = window.location.protocol === 'http:' ? 'ws://' : 'wss://';
                var address = protocol + window.location.host + window.location.pathname + '/ws';
                var socket = new WebSocket(address);
                socket.onmessage = function (msg) {
                    if (msg.data == 'reload') window.location.reload();
                    else if (msg.data == 'refreshcss') refreshCSS();
                };
                if (sessionStorage && !sessionStorage.getItem('IsThisFirstTime_Log_From_LiveServer')) {
                    console.log('Live reload enabled.');
                    sessionStorage.setItem('IsThisFirstTime_Log_From_LiveServer', true);
                }
                kamerajalan = true
            })();

            // if cek bagian undivinded
            // if (cekbagian == undefined) {
            //     console.log('bagian undifined')
            //     kamerajalan = false
            // } else {
            //     console.log('bagian tidak undifined')
            //     kamerajalan = true
            // }
        }
        else {
            console.error('Upgrade your browser. This Browser is NOT supported WebSocket for Live-Reloading.');
        }
    </script>

    <script>
        var panjangreader = document.getElementById("reader").offsetHeight;
        var html5QrcodeScanner = new Html5QrcodeScanner("reader", { fps: 10, qrbox: 250 });

        function factorpoin(barcode) {

            //const url = `http://34.171.82.75/find_barcode?barcode=${barcode}`;
            const url = `http://34.171.82.75/find_barcode?barcode=089686386110`;
            // Lakukan fetch ke URL
            return fetch(url)
                .then(response => {
                    // Periksa apakah responsenya sukses (status code 200 OK)
                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }
                    // Parse responsenya sebagai JSON
                    return response.json();
                })
                .then(data => {
                    // Ubah objek respons menjadi array
                    const dataArray = Object.values(data);
                    // Kembalikan array sebagai hasil
                    applay(dataArray)
                    return dataArray;
                })
                .catch(error => {
                    console.error('Ada masalah dengan fetch:', error);
                    // Jika terjadi kesalahan, kembalikan null atau nilai lain yang sesuai
                    return null;
                });
        }

        // Contoh pemanggilan fungsi dengan barcode tertentu
        function applay(params) {
            html5QrcodeScanner.clear();
            var bus = params[1] + params[2] + params[4] + params[5];
            //bila terdapat string yang berisi -1
            if (bus.includes("-01")) {
                //save ke data pengguna
                console.log("war")
                document.getElementById('NamaProduk').value = params[3]
                document.getElementById('tombolmodal1').click()
            } else {
                // open modal dengan js
            }
        }

        function onScanSuccess(decodedText, decodedResult) {
            console.log(`Scan result: ${decodedText}`, decodedResult);
            document.getElementById('codp').innerHTML = decodedText
            document.getElementById('fdBarcode').value = decodedText
            var wp = factorpoin(decodedText)
            if (!isNaN(decodedText)) {
            } else {
                document.getElementById("barcodepoin").innerHTML = "invalid barcode";
            }
        }

        function loadpoin() {
            var p = html5QrcodeScanner.render(onScanSuccess);
            console.log(html5QrcodeScanner)
            console.log(p)
            if (kamerajalan) {
                setTimeout(() => {
                    document.getElementById('reader__dashboard_section_csr').style.display = 'none'
                }, 500);
            } else {
                // alert('Device Perlu meminta Izin Penggunaan Kamera')
            }
            setInterval(() => {
                // document.getElementById('reader__dashboard').style.marginTop = "7rem";
                // if (document.getElementById('reader__dashboard').innerHTML != "Request Camera Permissions") {
                // document.getElementById('reader__dashboard').style.zIndex = "-1";
                // }
            }, 100);
        }

        loadpoin();
    </script>
</body>

</html>